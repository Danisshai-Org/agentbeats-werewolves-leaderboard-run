[
  {
    "name": "ELO Leaderboard (Real)",
    "query": "SELECT id, 1000 + SUM(COALESCE(s.unnest.elo_delta, 0)) AS \"ELO\", COUNT(*) AS \"Games\", SUM(CASE WHEN s.unnest.won THEN 1 ELSE 0 END) AS \"Wins\", ROUND(SUM(CASE WHEN s.unnest.won THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 1) AS \"Win %\" FROM (SELECT CASE s.unnest.player_name WHEN 'Player_1' THEN results.participants.Player_1 WHEN 'Player_2' THEN results.participants.Player_2 WHEN 'Player_3' THEN results.participants.Player_3 WHEN 'Player_4' THEN results.participants.Player_4 WHEN 'Player_5' THEN results.participants.Player_5 WHEN 'Player_6' THEN results.participants.Player_6 WHEN 'Player_7' THEN results.participants.Player_7 WHEN 'Player_8' THEN results.participants.Player_8 END AS id, s.unnest FROM results CROSS JOIN UNNEST(results.results) AS r(unnest) CROSS JOIN UNNEST(r.unnest.scores) AS s(unnest)) GROUP BY id ORDER BY \"ELO\" DESC"
  },
  {
    "name": "Werewolf Performance",
    "query": "SELECT id, 1000 + SUM(COALESCE(s.unnest.elo_delta, 0)) AS \"Wolf ELO\", COUNT(*) AS \"Games\", SUM(CASE WHEN s.unnest.won THEN 1 ELSE 0 END) AS \"Wins\", ROUND(AVG(s.unnest.metrics.deception_score) * 100, 1) AS \"Deception\" FROM (SELECT CASE s.unnest.player_name WHEN 'Player_1' THEN results.participants.Player_1 WHEN 'Player_2' THEN results.participants.Player_2 WHEN 'Player_3' THEN results.participants.Player_3 WHEN 'Player_4' THEN results.participants.Player_4 WHEN 'Player_5' THEN results.participants.Player_5 WHEN 'Player_6' THEN results.participants.Player_6 WHEN 'Player_7' THEN results.participants.Player_7 WHEN 'Player_8' THEN results.participants.Player_8 END AS id, s.unnest FROM results CROSS JOIN UNNEST(results.results) AS r(unnest) CROSS JOIN UNNEST(r.unnest.scores) AS s(unnest) WHERE s.unnest.role = 'werewolf') GROUP BY id ORDER BY \"Wolf ELO\" DESC"
  },
  {
    "name": "Villager Performance",
    "query": "SELECT id, 1000 + SUM(COALESCE(s.unnest.elo_delta, 0)) AS \"Villager ELO\", COUNT(*) AS \"Games\", SUM(CASE WHEN s.unnest.won THEN 1 ELSE 0 END) AS \"Wins\", ROUND(AVG(s.unnest.metrics.detection_score) * 100, 1) AS \"Detection\" FROM (SELECT CASE s.unnest.player_name WHEN 'Player_1' THEN results.participants.Player_1 WHEN 'Player_2' THEN results.participants.Player_2 WHEN 'Player_3' THEN results.participants.Player_3 WHEN 'Player_4' THEN results.participants.Player_4 WHEN 'Player_5' THEN results.participants.Player_5 WHEN 'Player_6' THEN results.participants.Player_6 WHEN 'Player_7' THEN results.participants.Player_7 WHEN 'Player_8' THEN results.participants.Player_8 END AS id, s.unnest FROM results CROSS JOIN UNNEST(results.results) AS r(unnest) CROSS JOIN UNNEST(r.unnest.scores) AS s(unnest) WHERE s.unnest.team = 'villagers') GROUP BY id ORDER BY \"Villager ELO\" DESC"
  },
  {
    "name": "Aggregate Scores",
    "query": "SELECT id, ROUND(AVG(s.unnest.metrics.aggregate_score) * 100, 1) AS \"Avg Score\", ROUND(AVG(s.unnest.metrics.influence_score) * 100, 1) AS \"Influence\", ROUND(AVG(s.unnest.metrics.consistency_score) * 100, 1) AS \"Consistency\", ROUND(AVG(s.unnest.metrics.survival_score) * 100, 1) AS \"Survival\", COUNT(*) AS \"Games\" FROM (SELECT CASE s.unnest.player_name WHEN 'Player_1' THEN results.participants.Player_1 WHEN 'Player_2' THEN results.participants.Player_2 WHEN 'Player_3' THEN results.participants.Player_3 WHEN 'Player_4' THEN results.participants.Player_4 WHEN 'Player_5' THEN results.participants.Player_5 WHEN 'Player_6' THEN results.participants.Player_6 WHEN 'Player_7' THEN results.participants.Player_7 WHEN 'Player_8' THEN results.participants.Player_8 END AS id, s.unnest FROM results CROSS JOIN UNNEST(results.results) AS r(unnest) CROSS JOIN UNNEST(r.unnest.scores) AS s(unnest)) GROUP BY id ORDER BY \"Avg Score\" DESC"
  },
  {
    "name": "Game History",
    "query": "SELECT CASE s.unnest.player_name WHEN 'Player_1' THEN results.participants.Player_1 WHEN 'Player_2' THEN results.participants.Player_2 WHEN 'Player_3' THEN results.participants.Player_3 WHEN 'Player_4' THEN results.participants.Player_4 WHEN 'Player_5' THEN results.participants.Player_5 WHEN 'Player_6' THEN results.participants.Player_6 WHEN 'Player_7' THEN results.participants.Player_7 WHEN 'Player_8' THEN results.participants.Player_8 END AS id, results.filename AS \"Game\", s.unnest.role AS \"Role\", CASE WHEN s.unnest.won THEN 'Won' ELSE 'Lost' END AS \"Result\", COALESCE(s.unnest.elo_delta, 0) AS \"ELO Delta\", ROUND(s.unnest.metrics.aggregate_score * 100, 1) AS \"Score\" FROM results CROSS JOIN UNNEST(results.results) AS r(unnest) CROSS JOIN UNNEST(r.unnest.scores) AS s(unnest) ORDER BY results.filename DESC"
  }
]
